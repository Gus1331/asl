<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <script src="js/sessao.js"></script>
    <link rel="stylesheet" href="style/geral.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="shortcut icon" href="assets/content/logo.png" type="image/x-icon">


</head>

<body onload="obterDadosGrafico()">
    <div class="containerFull">
        <main>
            <div class="sidebar">

                <div class="topSidebar">
                    <div class="icon">
                        <img src="https://cdn-icons-png.flaticon.com/512/5087/5087579.png">
                    </div>
                    <h2 id="b_usuario">User123</h2>
                    <div class="userOptions">
                        <img src="assets/content/useroptions-icon.png">
                    </div>
                </div>

                <div class="midSidebar">
                    <div class="listTitle">
                        <h1>Dashboards</h1>
                        <div class="icon">
                            <img src="assets/content/dashbord-icon.png">
                        </div>
                    </div>
                    <ul>
                        <a href="producao.html" rel="prev">
                            <li class="li">
                                Produção
                                <div class="icon">
                                    <img src="assets/content/producao-icon.png">
                                </div>
                            </li>
                        </a>
                        <div class="listLines">
                            <div class="line"></div>
                            <div class="line"></div>
                        </div>
                        <a href="renda.html" rel="prev">
                            <li>
                                Renda
                                <div class="icon">
                                    <img src="assets/content/renda-icon.png">
                                </div>
                            </li>
                        </a>
                        <div class="listLines">
                            <div class="line"></div>
                            <div class="line"></div>
                        </div>
                        <div class="selected">
                            <a href="" rel="prev">
                                <li>
                                    Geral
                                    <div class="icon">
                                        <img src="assets/content/geral-icon.png">
                                    </div>
                                </li>
                            </a>
                        </div>
                        <div class="listLines">
                            <div class="line"></div>
                            <div class="line"></div>
                        </div>
                        <a href="configuracoes.html" rel="next">
                            <li>
                                Configurações
                                <div class="icon">
                                    <img src="assets/content/config-icon.png">
                                </div>
                            </li>
                        </a>
                    </ul>
                </div>

                <div class="bottomSidebar">
                    <div class="logo icon">
                        <img src="assets/content/logo.png">
                    </div>
                    <p class="version">Versão 1.00</p>
                </div>

            </div>










            <!-- Graficos-->
            <div class="whiteBoard">
                <div class="dashboard">
                    <div class="chart1">
                        <div>

                            <canvas id="canvas_chart04"></canvas>
                        </div>
                    </div>
                    <div class="chart2">
                        <div>

                            <canvas id="canvas_chart05"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Filtro tabela -->
                <nav class="filtro">
                    <div class="search">
                        <input type="text">
                        <button><img src="assets/content/lupa-icon.png"></button>
                    </div>
                    <span>Filtrar por:</span>
                    <select id="select_filtrar_produto">
                        <option disabled selected>Produto</option>
                        <option value="Garrafa CB-4">Garrafa CB-4</option>
                        <option value="Frasco 986">Frasco 986</option>
                        <option value="Frasco 234">Frasco 234</option>
                        <option value="Garrafa HJ-4">Garrafa HJ-4</option>
                        <option value="Copo Especial 3">Copo Especial 3</option>
                    </select>
                    <select id="select_filtrar_status">
                        <option disabled selected>Status</option>
                        <option value="Funcionando">Funcionando</option>
                        <option value="Parado">Parado</option>

                    </select>
                    <span>Ordem:</span>
                    <select id="select_ordem">
                        <option value="Crescente">Crescente</option>
                        <option value="Decrescente">Decrescente</option>
                    </select>
                </nav>


                <!-- TABELA -->

                <div class="container">
                    <table id="table_search">
                        <tr>
                            <th>Identificação</th>
                            <th>Produto</th>
                            <th>Status</th>
                            <th>Prod. Estimada</th>
                            <th>Prod. Real</th>
                        </tr>
                        <!-- <tr>
                            <td>Esteira A</td>
                            <td>Garrafa CB-4</td>
                            <td>Funcionando</td>
                            <td>25/min</td>
                            <td class="green">26/min</td>
                        </tr>
                        <tr>
                            <td>Esteira B</td>
                            <td>Frasco 986</td>
                            <td>Parado</td>
                            <td>22/min</td>
                            <td class="red">0/min</td>
                        </tr>
                        <tr>
                            <td>Esteira C</td>
                            <td>Frasco 234</td>
                            <td>Funcionando</td>
                            <td>25/min</td>
                            <td class="red">16/min</td>
                        </tr>
                        </tr>
                        <tr>
                            <td>Esteira D</td>
                            <td>Garrafa HJ-4</td>
                            <td>Funcionando</td>
                            <td>26/min</td>
                            <td class="green">24/min</td>
                        </tr>
                        </tr>
                        <tr>
                            <td>Esteira E</td>
                            <td>Garrafa CB-8</td>
                            <td>Parado</td>
                            <td>25/min</td>
                            <td class="red">0/min</td>
                        </tr>
                        </tr>
                        <tr>
                            <td>Esteira F</td>
                            <td>Copo Especial 3</td>
                            <td>Funcionando</td>
                            <td>25/min</td>
                            <td class="green">25/min</td>
                        </tr>
                        <td>Esteira G</td>
                        <td>Copo Especial 3</td>
                        <td>Funcionando</td>
                        <td>35/min</td>
                        <td class="green">34/min</td>
                        </tr>
                        <td>Esteira H</td>
                        <td>Frasco 986</td>
                        <td>Funcionando</td>
                        <td>20/min</td>
                        <td class="green">25/min</td>
                        </tr>
                        <td>Esteira I</td>
                        <td>Garrafa CB-4</td>
                        <td>Parado</td>
                        <td>25/min</td>
                        <td class="red">0/min</td>
                        </tr> -->
                    </table>
                </div>

            </div>
    </div>
    </main>
</body>
</html>
<script>
        b_usuario.innerHTML = sessionStorage.NOME_USUARIO;

        const ctx05 = document.getElementById('canvas_chart05');

        new Chart(ctx05, {
            type: 'bar',
            data: {
                labels: ['2011', '2012', '2013', '2014', '2015', '2016', '2017', '2018', '2019', '2020', '2021', '2022'],
                datasets: [{
                    label: 'Produção',
                    data: [200000, 250000, 190000, 200000, 170000, 190000, 250000, 290000, 270000, 280000, 250000, 290000],
                    borderWidth: 1,
                    backgroundColor: '#FF7A48',
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        min: 50000,
                        max: 300000,
                        ticks: {
                            stepSize: 5000
                        }

                    }
                }
            }
        });
        const ctx04 = document.getElementById('canvas_chart04');

        new Chart(ctx04, {
            type: 'bar',
            data: {
                labels: ['2011', '2012', '2013', '2014', '2015', '2016', '2017', '2018', '2019', '2020', '2021', '2022'],
                datasets: [{
                    label: 'Lucro Anual',
                    data: [2200000, 2500000, 1900000, 2000000, 1700000, 1900000, 2500000, 2900000, 2700000, 2800000, 2500000, 2900000],
                    borderWidth: 1,
                    backgroundColor: '#103778',
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        min: 500000,
                        max: 3000000,
                        ticks: {
                            stepSize: 50000
                        }

                    }
                }
            }
        });

        function obterDadosGrafico() {

            fetch(`/esteira/ultimas`, { cache: 'no-store' }).then(function (response) {
                if (response.ok) {
                    response.json().then(function (resposta) {
                        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                        resposta.reverse();

                        plotarGrafico(resposta);
                    });
                } else {
                    console.error('Nenhum dado encontrado ou erro na API');
                }
            })
                .catch(function (error) {
                    console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
                });
        }

        function plotarGrafico(resposta) {

            for (i = 0; i < resposta.length; i++) {
                var registro = resposta[i];

                table_search.innerHTML =
                    `<tr>
                        <td>${registro.identificacao}</td>
                        <td>${registro.produto}</td>
                        <td>${registro.condicao}</td>
                        <td>${registro.producaoPorMin}</td>
                        <td>${registro.registro}</td>
                    </tr>`
            }
        }

    </script>